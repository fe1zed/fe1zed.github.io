<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Instant Localization — fe1zed</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Instant Localization — CSV-based localization system with editor tools and QA." />

    <!-- Styles -->
    <script src="/assets/js/bootstrap.js"></script>

    <style>
        html.boot body { visibility: hidden; }
    </style>
    <script>
        document.documentElement.classList.add("boot");
    </script>
</head>

<body>
<!-- Header -->
<div id="site-header"></div>

<main class="container" style="padding:60px 0; max-width:980px;">
    <a class="back-btn" href="javascript:history.back()">← Back</a>
    <div style="display:grid; grid-template-columns: 1.2fr 1fr; gap:24px; align-items:start;">
        <div>
            <h1 style="margin:0 0 12px;">Instant Localization</h1>
            <p class="hero-subtitle" style="margin:0 0 18px;">
                CSV-based localization workflow with editor tooling, QA, and auto-translate pipeline.
            </p>

            <div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:18px;">
                <span class="chip" style="cursor:default;">CSV</span>
                <span class="chip" style="cursor:default;">Editor Tools</span>
                <span class="chip" style="cursor:default;">QA</span>
                <span class="chip" style="cursor:default;">Auto Translate</span>
            </div>

            <div style="display:flex; gap:12px; flex-wrap:wrap;">
                <a class="chip" href="https://assetstore.unity.com/" target="_blank" rel="noopener" style="font-size:14px;">Asset Store →</a>
            </div>
        </div>

        <!-- MEDIA (middle-right) -->
        <div class="product-media">
            <div class="media-card" id="il-media">
                <div class="media-viewport">
                    <div class="media-track" data-track></div>
                </div>
                <div class="media-indicators" data-dots></div>
            </div>
        </div>
    </div>

    <script>
        (function () {
            const PREFIX = window.__SITE_PREFIX__ || "";
            const root = document.getElementById("il-media");
            if (!root) return;

            const track = root.querySelector("[data-track]");
            const dots = root.querySelector("[data-dots]");

            const MANIFEST_URL = PREFIX + "/products/instant-localization/media/media.json";
            const MEDIA_BASE = PREFIX + "/products/instant-localization/media/";

            const DURATION_MS = 4200; // time to fill one bar
            const SLIDE_MS = 520;     // should match CSS transition

            let items = [];
            let index = 0;

            let running = true;
            let hovering = false;

            let lastT = 0;
            let progress = 0; // 0..1
            let rafId = 0;

            function clamp01(v) { return Math.max(0, Math.min(1, v)); }

            function setIndex(i) {
                index = (i + items.length) % items.length;
                track.style.transform = "translateX(" + (-index * 100) + "%)";
                progress = 0;
                updateBars();
            }

            function updateBars() {
                const bars = dots.querySelectorAll(".media-bar > span");
                for (let i = 0; i < bars.length; i++) {
                    if (i < index) bars[i].style.transform = "scaleX(1)";
                    else if (i > index) bars[i].style.transform = "scaleX(0)";
                    else bars[i].style.transform = "scaleX(" + clamp01(progress) + ")";
                }
            }

            function next() {
                setIndex(index + 1);
            }

            function tick(t) {
                rafId = requestAnimationFrame(tick);

                if (!running || hovering || items.length <= 1) {
                    lastT = t;
                    return;
                }

                if (!lastT) lastT = t;
                const dt = Math.min(64, t - lastT);
                lastT = t;

                progress = clamp01(progress + dt / DURATION_MS);
                updateBars();

                if (progress >= 1) {
                    // advance after fill
                    // reset progress immediately to avoid flashing full bar during transition
                    progress = 0;
                    next();
                }
            }

            function makeSlide(item) {
                const slide = document.createElement("div");
                slide.className = "media-slide";

                // IMAGE
                if (item.type === "image") {
                    const img = document.createElement("img");
                    img.alt = "";
                    img.loading = "eager";
                    img.decoding = "async";
                    img.src = MEDIA_BASE + item.src;
                    slide.appendChild(img);
                }

                // YOUTUBE
                else if (item.type === "youtube") {
                    const iframe = document.createElement("iframe");
                    iframe.src =
                        "https://www.youtube.com/embed/" +
                        item.id +
                        "?rel=0&modestbranding=1&playsinline=1";

                    iframe.allow =
                        "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
                    iframe.allowFullscreen = true;

                    iframe.style.width = "100%";
                    iframe.style.height = "100%";
                    iframe.style.border = "0";

                    slide.appendChild(iframe);
                }

                return slide;
            }


            function buildUI() {
                track.innerHTML = "";
                dots.innerHTML = "";

                for (let i = 0; i < items.length; i++) {
                    track.appendChild(makeSlide(items[i]));

                    const bar = document.createElement("div");
                    bar.className = "media-bar";

                    const fill = document.createElement("span");
                    bar.appendChild(fill);

                    bar.addEventListener("click", function () {
                        setIndex(i);
                    });

                    dots.appendChild(bar);
                }

                setIndex(0);
            }

            async function loadManifest() {
                try {
                    const res = await fetch(MANIFEST_URL, { cache: "no-cache" });
                    if (!res.ok) throw new Error("Manifest fetch failed: " + res.status);
                    const json = await res.json();
                    const list = Array.isArray(json.items) ? json.items : [];
                    items = list.filter(Boolean);
                } catch (e) {
                    // fallback: show nothing (or you can hardcode items here)
                    console.warn("[Media] No manifest / empty:", e);
                    items = [];
                }
            }

            function setupPauseOnHover() {
                root.addEventListener("mouseenter", function () { hovering = true; });
                root.addEventListener("mouseleave", function () { hovering = false; });

                document.addEventListener("visibilitychange", function () {
                    running = (document.visibilityState === "visible");
                    lastT = 0;
                });
            }

            (async function init() {
                await loadManifest();

                if (!items.length) {
                    // Hide the whole card if no media
                    root.style.display = "none";
                    return;
                }

                buildUI();
                setupPauseOnHover();

                rafId = requestAnimationFrame(tick);
            })();
        })();
    </script>


    <div style="margin-top:40px;">
        <h2>Key Features</h2>
        <ul style="color: var(--text-muted); line-height:1.7;">
            <li>Fast CSV import/export workflow</li>
            <li>Editor windows for managing languages and keys</li>
            <li>QA dashboard: missing/empty/duplicate keys</li>
            <li>Auto-translate providers (DeepL, Azure)</li>
            <li>Safe apply policies and preview before writing</li>
        </ul>
    </div>

    <div style="margin-top:28px;">
        <h2>Requirements</h2>
        <ul style="color: var(--text-muted); line-height:1.7;">
            <li>Unity 2021+</li>
            <li>TextMeshPro</li>
        </ul>
    </div>

    <div style="margin-top:28px;">
        <h2>Support</h2>
        <p style="color: var(--text-muted);">
            Use the support page for help and bug reports:
            <a class="footer-link" href="/pages/support.html"><b>Support</b></a>
        </p>
    </div>
</main>

<!-- Footer -->
<div id="site-footer"></div>
<script src="/assets/js/layout.js"></script>

</body>
</html>